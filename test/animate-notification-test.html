<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-notification tests</title>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../vaadin-notification.html">
</head>

<body>
  <dom-module id="vaadin-notification-overlay-animation-theme" theme-for="vaadin-notification-overlay">
    <template>
      <style>
        @keyframes test-animation {
          100% {
            opacity: 0;
          }
        }

        [part="middle"] > vaadin-notification-card[closing] {
          animation: test-animation 10ms;
        }
      </style>
    </template>
  </dom-module>

  <dom-module id="vaadin-notification-card-animation-theme" theme-for="vaadin-notification-card">
    <template>
      <style>
        :host {
          width: 200px;
          background: lightgrey;
        }
      </style>
    </template>
  </dom-module>

  <test-fixture id="notification">
    <template>
      <vaadin-notification opened duration="10"><template>Notificaton</template></vaadin-notification>
      <vaadin-notification opened duration="10" vertical-align="middle"><template>Notificaton</template></vaadin-notification>
    </template>
  </test-fixture>

  <script>
    describe('animated notifications', function() {
      let notifications, overlay;

      beforeEach(done => {
        notifications = Array.from(fixture('notification'));
        overlay = notifications[0]._overlay;
        setTimeout(done);
      });

      describe('animation', () => {
        it('should remove card inmediatly if not animation defined', done => {
          setTimeout(() => {
            expect(notifications[0]._card.parentNode).not.to.be.ok;
            done();
          }, 15);
        });

        it('should not remove card after timeout if animation running', done => {
          setTimeout(() => {
            expect(notifications[1]._card.parentNode).to.be.ok;
            done();
          }, 15);
        });

        it('should remove card after animation', done => {
          setTimeout(() => {
            expect(notifications[1]._card.parentNode).not.to.be.ok;
            done();
          }, 40);
        });

        it('should close the overlay when all active notifications dissapear', done => {
          setTimeout(() => {
            expect(overlay.opened).to.be.false;
            done();
          }, 40);
        });

        it('should set `closing` attribute and remove later', done => {
          setTimeout(() => {
            expect(notifications[0]._card.hasAttribute('closing')).to.be.false;
            expect(notifications[1]._card.hasAttribute('closing')).to.be.true;
            setTimeout(() => {
              expect(notifications[0]._card.hasAttribute('closing')).to.be.false;
              expect(notifications[1]._card.hasAttribute('closing')).to.be.false;
              done();
            }, 21);
          }, 11);
        });
      });
    });
  </script>
</body>
